name: build

on:
  pull_request:
    branches:
      - main
    paths:
      - '**/*.swift'
      - '.github/workflows/build.yml'

jobs:
  build:
    runs-on: windows-latest

    strategy:
      matrix:
        include:
          # - branch: swift-5.4.3-release
          #  tag: 5.4.3-RELEASE

          # - branch: swift-5.5-release
          #  tag: 5.5-RELEASE

          - branch: development
            tag: DEVELOPMENT-SNAPSHOT-2021-10-27-a

    steps:    
    - uses: compnerd/gha-setup-swift@main
      with:
        tag: ${{ matrix.tag }}
        branch: ${{ matrix.branch }}

    - uses: actions/checkout@v2
    
    - run: |
        curl.exe -sL "https://artprodeus21.artifacts.visualstudio.com/A8fd008a0-56bc-482c-ba46-67f9425510be/3133d6ab-80a8-4996-ac4f-03df25cd3224/_apis/artifact/cGlwZWxpbmVhcnRpZmFjdDovL2NvbXBuZXJkL3Byb2plY3RJZC8zMTMzZDZhYi04MGE4LTQ5OTYtYWM0Zi0wM2RmMjVjZDMyMjQvYnVpbGRJZC81NDc3Ni9hcnRpZmFjdE5hbWUvZGV2dG9vbHMtd2luZG93cy14NjQ1/content?format=file&subPath=%2FLibrary%2FDeveloper%2FToolchains%2Funknown-Asserts-development.xctoolchain%2Fusr%2Fbin%2FArgumentParserToolInfo.dll" -o "C:\Library\Developer\Toolchains\unknown-Asserts-development.xctoolchain\usr\bin\ArgumentParserToolInfo.dll"
        curl.exe -sL "https://artprodeus21.artifacts.visualstudio.com/A8fd008a0-56bc-482c-ba46-67f9425510be/3133d6ab-80a8-4996-ac4f-03df25cd3224/_apis/artifact/cGlwZWxpbmVhcnRpZmFjdDovL2NvbXBuZXJkL3Byb2plY3RJZC8zMTMzZDZhYi04MGE4LTQ5OTYtYWM0Zi0wM2RmMjVjZDMyMjQvYnVpbGRJZC81NDc3Ni9hcnRpZmFjdE5hbWUvZGV2dG9vbHMtd2luZG93cy14NjQ1/content?format=file&subPath=%2FLibrary%2FDeveloper%2FToolchains%2Funknown-Asserts-development.xctoolchain%2Fusr%2Fbin%2FPackageRegistry.dll" -o "C:\Library\Developer\Toolchains\unknown-Asserts-development.xctoolchain\usr\bin\PackageRegistry.dll"

    - name: Resolve
      run: swift package resolve --very-verbose 

    - name: Build
      run: swift build -v

    - name: Run tests
      run: swift test -v -Xswiftc -DENABLE_TESTING
