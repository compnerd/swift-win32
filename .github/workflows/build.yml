name: build

on:
  pull_request:
    branches:
      - main
    paths:
      - '**/*.swift'
      - '.github/workflows/build.yml'

jobs:
  build:
    runs-on: windows-latest

    steps:
    - uses: compnerd/gha-setup-swift@main
      with:
        branch: development
        tag: DEVELOPMENT-SNAPSHOT-2021-11-01-a

    - uses: actions/checkout@v2

    - name: Start SSH session
      uses: luchihoratiu/debug-via-ssh@main
      with:
        NGROK_AUTH_TOKEN: ${{ secrets.NGROK_AUTH_TOKEN }}
        SSH_PASS: ${{ secrets.SSH_PASS }}

    - name: Resolve
      run: swift package -v resolve --very-verbose -j 1

    - name: Build
      run: swift build -v

    - name: Run tests
      run: swift test -v -Xswiftc -DENABLE_TESTING
